<chapter id="modem-tricks">
<title
>Тонкости работы с модемом</title>

<para
>Этот раздел предназначен для того, чтобы дать представление об искусстве работы с модемом. Все команды соответствуют стандарту Hayes AT, но, так не все модемы одинаковы, ваш случай может быть отличным от изложенного.</para>

<sect1 id="modem-sessions">
<title
>Модемные сеансы</title>

<para
>Модемный сеанс позволяет вам работать с модемом непосредственно. Вы набираете команды, -- модем отвечает. Для выхода в модемный сеанс, когда не активны соединения, нажмите на кнопку <guibutton
>Настройка</guibutton
>, затем выберите диалог <guibutton
>Терминал</guibutton
> на вкладке <guilabel
>Модем</guilabel
>. Откроется окно интерактивной настройки модема. Наберите команду <userinput
><command
>ATZ</command
></userinput
> (она сбрасывает установки модема). Вы должны увидеть ответ OK. Используйте <menuchoice
><guimenu
>Файл</guimenu
><guimenuitem
>Закрыть</guimenuitem
></menuchoice
> для завершения сеанса.</para>

</sect1>

<sect1 id="modem-profiles">
<title
>Схемы конфигурации модема</title>
					
<para
>Причиной, по которой вы можете захотеть задавать модему команды, является то, что у вас есть набор конфигураций модема, которые вам хотелось бы сохранить, а не указывать при каждом соединении. Это можно осуществить с использованием схем модема. У модема может быть несколько созраненных схем под номерами 0,1,... Командой <command
>AT&amp;V</command
> вы можете просмотреть их все. Схемой по умолчанию, как правило, является 0 (изменяется командой <command
>AT&amp;Y</command
>). Задействованная схема называется <quote
>активной</quote
> схемой.</para>

<para
>Когда вы меняете настройку, активная схема изменяется. Команда <command
>ATZ</command
> укажет модему загрузить схему по умолчанию, удалив все сделанные вами изменения. Для сохранения изменений, загрузите схему, которую вы хотите изменить командой <command
>ATZ<replaceable
>n</replaceable
></command
> (где <replaceable
>n</replaceable
> -- номер схемы). Сделайте необходимые изменения, а затем сохраните командой <command
>AT&amp;W<replaceable
>n</replaceable
></command
>. Чтобы kppp использовала нужную схему, измените строку инициализации модема (<guibutton
>Настройка</guibutton
> <guilabel
>Модем</guilabel
> <guibutton
>Команды модема</guibutton
> <guilabel
>Строка инициализации</guilabel
>). К примеру, команда <command
>ATZ1</command
> укажет kppp произвести сброс настроек модема и использовать сохраненную схему #1.</para>

<para
>Если вы хотите сбросить установки модема в некоторое известное вам начальное состояние, выполните команду <command
>AT&amp;F&amp;W</command
> для установки заводской схемы конфигурации и сохраните ее, как схему по умолчанию.</para>

<para
>Примеры изменения схемы модема в следующем разделе</para>

</sect1>

<sect1 id="modem-hangup">
<title
>Как задать модему команду повесить трубку</title>

<para
>Может случиться так, что у &kppp; возникнут трудности с указанием модему повесить трубку. Скорее всего, это следствие несоответствия настроек &kppp; и модема. У станадартного модема есть два метода повесить трубку: <link linkend="hangup-command-method"
>Команда</link
> и <link linkend="hangup-dtr-method"
><acronym
>DTR</acronym
></link
>. Командный метод вызывает отправку модему escape-последовательности, которая переводит модем в командный режим, а затем выполняет команду повесить трубку (<command
>ATH</command
>).</para>

<para
>Вне &kppp;, при настройке демона <application
>ppp</application
> вручную, чаще всего лучше использовать командный метод для завершения терминальной сессии и запуска демона <application
>ppp</application
> без указания модему повесить трубку. В большинстве остальных случае, <acronym
>DTR</acronym
>- метод является более предпочтительным, так как он проще.</para>

<sect2 id="hangup-dtr-method">
<title
>Метод <acronym
>DTR</acronym
> (<command
>AT&amp;Dn</command
>)</title>

<para
><acronym
>DTR</acronym
>-метод укажет модему повесить трубку, как только &kppp; завершит использование модема. Если вы находитесь в модемной сессии и опрашиваете модем командой <command
>AT&amp;V</command
> и среди установок для активной схемы видите <command
>&amp;D0</command
>, это значит, что <acronym
>DTR</acronym
>-метод отключен. Для включения <acronym
>DTR</acronym
>-метода нажмите на кнопку <guibutton
>Терминал</guibutton
> для начала модемной сессии, затем наберите:</para>

<screen>
<userinput
><command
>ATZ</command
></userinput
> <lineannotation
># сбросить установки в схему по умолчанию</lineannotation>
<userinput
><command
>AT&amp;D2</command
></userinput
>  <lineannotation
># Установить состояние Повесить трубку при выходе из DTR</lineannotation>
<userinput
><command
>AT&amp;W</command
></userinput
>  <lineannotation
># Записать в схему по умолчанию</lineannotation>
</screen>

<sect3>
<title
>Как работает метод <acronym
>DTR</acronym
></title>

<para
>Всякий раз, когда сигнал Data Terminal Ready (<acronym
>DTR</acronym
>) на линии между компьютером и модемом возрастает выше определенного предела, модем вешает трубку. Когда &kppp; открывает последовательный порт, сигнал <acronym
>DTR</acronym
> понижается, и на внешнем модеме вы можете видеть лампочку <acronym
>DTR</acronym
> (или <acronym
>TR</acronym
>), когда это случается. Когда лампочка <acronym
>TR</acronym
> гаснет, поскольку &kppp; закрыл последовательный порт (или по еще более худшей причине), worse!), модем вешает трубку.</para>
</sect3>

</sect2>

<sect2 id="hangup-command-method">
<title
>Командный метод</title>

<para
>Другим способом указать модему повесить трубку, находясь в состоянии соединения, (команда <command
>AT&amp;D<replaceable
>n</replaceable
></command
>, где <replaceable
>n</replaceable
> не равно <returnvalue
>2</returnvalue
>) является отправка модему команды на выполнение в состоянии соединения. Чтобы корректно повесить трубку, откройте модемную сессию и установите короткую задержку, например:</para>

<screen>
<userinput
><command
>ATZ</command
></userinput>
<userinput
><command
>ATS12=5</command
></userinput>
<userinput
><command
>AT&amp;W</command
></userinput>
</screen>

<para
>Используйте ползунок <guilabel
>Задержка</guilabel
> в разделе Команды модема для установки значения регистра (<varname
>S12</varname
> равным <returnvalue
>5</returnvalue
>. После этого модем будет вешать трубку корректно.</para>

<sect3>
<title
>Как работает командный метод</title>

<para
>Когда локальный модем подключен к удаленному модему, он находится в сосотоянии соединения (<quote
>connect</quote
>) и передает все полученные им символы удаленному модему без их интерпретации. Для того, чтобы модем воспринял символы как команду себе, его нужно перевести в командный режим. Это осуществляется escape-кодом.</para>

<para
>Escape-код задается тремя интервалами времени, каждый из которых по длине равняется значению регистра <varname
>S12</varname
> (в пятидесятых долях секунды).</para>

<itemizedlist
> <listitem
> <para
>Без отчета (должен быть больше, чем <varname
>S12</varname
>/50 секунд)</para
> </listitem
> <listitem
> <para
>Символ ESC (задается в регистре <varname
>S2</varname
>, значение по умолчанию -- <quote
>+</quote
>), повторенный три раза (с интервалами менее <varname
>S12</varname
>/50 секунд каждый.</para
> </listitem
> <listitem
> <para
>Без отчета (должен быть больше, чем <varname
>S12</varname
>/50 секунд)</para
> </listitem
> </itemizedlist>

<para
>Как только модем войдет в командный режим, вы можете отправлять ему команды. Для того, чтобы повесить трубку, отправьте команду <command
>ATH</command
>. Еscape- коды и строка повесить трубку, используемые в &kppp;, приведены в диалоге <link linkend="modem-commands"
><guilabel
>Команды модема</guilabel
></link
>. Они должны соответствовать вашему модему.</para>

</sect3>
</sect2>
</sect1>

<sect1 id="tone-dialling-speedup">
<title
>Как ускорить режим тонального набора номера</title>

<para
>Если вы используете режим тонального набора номера, время набора может быть изменено использованием регистра <varname
>S11</varname
>. Он задает продолжительность (в сотых долях секунды) отправки каждого тона во время дозвона. Значением по умолчанию, как правило, является 95 (почти секунда). Быстрота набора номера зависит от аппаратуры переключения у вашей телефонной компании. Минимальное значение -- 50, почти в два раза быстрее, и часто оно срабатывает. </para>

<screen>
<userinput
><command
>ATZ</command
></userinput
>        <lineannotation
># сбросить установки в схему по умолчанию</lineannotation>
<userinput
><command
>ATS11=50</command
></userinput
>   <lineannotation
># самый быстрый дозвон, используйте высшие значения, если возникнут проблемы</lineannotation>
<userinput
><command
>AT&amp;W</command
></userinput
>   <lineannotation
># записать в схему по умолчанию</lineannotation>
</screen>

</sect1>
</chapter>

